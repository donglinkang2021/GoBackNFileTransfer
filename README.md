# GBNå®ç°å¯é æ–‡ä»¶ä¼ è¾“

> ä»ç½‘ä¸Šå¤§æ¦‚çœ‹äº†ä¸€ä¸‹åˆ«äººå®ç°çš„ä»£ç ï¼Œå¤§æ¦‚çŸ¥é“äº†ä¸€ä¸‹æ–¹å‘ï¼Œè§„åˆ’ä¸€ä¸‹è‡ªå·±ç›®å‰è®¡åˆ’

- [x] è°ƒç ”å®ç°GBNè¿˜éœ€è¦ç”¨åˆ°å“ªäº›åº“
  - [x] socket
  - [x] struct
  - [x] threading
- [x] å¼€å§‹å­¦ä¹ åŸºç¡€çš„socketç¼–ç¨‹
  - [x] å…ˆå®ç°ç®€å•çš„æ–‡ä»¶ä¼ è¾“åŠŸèƒ½ (å®ç°äº†æœ¬æœºä¸­windowsçš„ç®€å•ä¼ è¾“)
  - [x] å®ç°äº†å‘è™šæ‹Ÿæœºä¸­ä¼ è¾“æ–‡ä»¶
- [x] å­¦ä¹ åŸºç¡€çš„structåº“
  - [x] ä½¿ç”¨structåº“æ¥å®ç°æ•°æ®çš„æ‰“åŒ…å’Œè§£åŒ…
  - [x] å®ç°äº†è‡ªå·±çš„CRCæ ¡éªŒ
  - [x] å®ç°äº†è‡ªå®šä¹‰çš„packetç»“æ„
- [x] ä½¿ç”¨è‡ªå·±å®šä¹‰çš„åŸºç¡€pduæ¥ç”¨UDPä¼ æ•°æ®
  - [x] å­¦ä¹ UDPä¼ è¾“æ˜¯æ€ä¹ˆä¼ çš„ å†™äº†å„ç§ç®€å•çš„UDPä¼ è¾“å¼‚æ­¥æ”¶å‘ä¿¡æ¯
  - [x] ç°åœ¨æœ¬åœ°å®ç°æ–‡ä»¶å¦‚ä½•æ‰“åŒ…æˆpacket
  - [x] å…ˆä¼ ä¸€ä¸ªç®€å•çš„packet (åœ¨linuxå’Œwindowsä¹‹é—´)
  - [x] ä¼ packetå¹¶è·å¾—ack
  - [x] å®ç°è®°å½•é€šä¿¡æ—¥å¿—
  - [x] ä¿®æ”¹ä¸€ä¸‹ackçš„é€»è¾‘ [fix bug]
  - [x] æ·»åŠ æ˜¾ç¤ºæ”¶å‘äº†å¤šå°‘æ¡ä¿¡æ¯çš„å‡½æ•°
  - [x] æ·»åŠ è¶…æ—¶é‡ä¼ æ¨¡å—
  - [x] é‡æ„æ•´ä¸ªUDPClient.pyä¸ºä¸¤ä¸ªç±»ï¼Œå®Œæˆudpæ–‡ä»¶ä¼ è¾“
    - [x] UDPSender
    - [x] UDPReceiver
    - [x] ä½†ç›®å‰åªå®ç°äº†å•å‘ä¼ è¾“ï¼Œä½†ä¿è¯äº†æ–‡ä»¶çš„å¯é ä¼ è¾“
  - [x] ç°åœ¨è¦åšçš„äº‹æƒ…æ˜¯å®Œæˆä¸€ä¸ªpacketçš„é‡ä¼ 
    - [x] æµ‹è¯•é‡ä¼ 
  - [x] ä¼˜åŒ–å‘½å
- [x] æ”¹ä¸€ä¸‹loggingçš„é¡ºåº æ„Ÿè§‰è¿™è¾¹çš„é€»è¾‘è¿˜æ˜¯æœ‰ç‚¹é—®é¢˜
- [x] å®ç°æ»‘åŠ¨çª—å£ä¼ è¾“æ–‡ä»¶
  - [x] åœ¨ä¸€ä¸ªpacketçš„åŸºç¡€ä¸Šæ“ä½œå°±æ˜¯å¤šä¸ªpacketçš„æ“ä½œ
  - [x] æµ‹è¯•ä¸åŒçª—å£å¤§å°å¯¹ä¼ è¾“é€Ÿåº¦çš„å½±å“ çœ‹çœ‹æœ‰æ²¡æœ‰å…¶å®ƒbug
  - [x] é”™è¯¯ç”Ÿæˆæ˜¯åœ¨å‘é€ç«¯ å‘é€å¤šä¸ªpacketçš„æ—¶å€™ï¼Œéšæœºç”ŸæˆPDUé”™è¯¯æˆ–è€…PDUä¸¢å¤±
  - [x] æµ‹è¯•é”™è¯¯ç”Ÿæˆ
  - [x] è¯»å–æ—¥å¿—æ–‡ä»¶ï¼Œå¯¹é€šä¿¡çŠ¶æ€è®°å½•æ•°æ®è¿›è¡Œç»Ÿè®¡åˆ†æ
  - [x] çœ‹ä¸€ä¸‹å¯ä¸å¯ä»¥ä¼˜åŒ–ä¸€ä¸‹é€Ÿåº¦ å‡å°‘è¶…æ—¶é‡ä¼ çš„æ¬¡æ•°
    - [x] ä¼˜åŒ–Go Back N çš„å®ç°
    - [x] æ€è€ƒè¶…æ—¶é‡ä¼ å’Œé‡ä¼ çš„å…³ç³»
  - [ ] ä¸‹ä¸€æ­¥å¯ä»¥åšçš„äº‹æƒ…æ˜¯ç»Ÿè®¡æ•°æ®
    - [ ] æ–‡ä»¶åˆ’åˆ†çš„ PDU æ€»æ•°é‡
    - [ ] é€šä¿¡æ€»æ¬¡æ•°
    - [ ] è¶…æ—¶æ¬¡æ•°
    - [ ] é‡ä¼  PDU çš„æ•°é‡
    - [ ] æ€»è€—æ—¶
- [ ] å°†ä¸¤ä¸ªç±»åˆå¹¶ä¸ºä¸€ä¸ªç±»
  - [ ] ç¬¬ä¸€ä»¶è¦åšçš„äº‹æƒ…å°±æ˜¯å‘½åä¸€è‡´

## åŸºæœ¬åŠŸèƒ½å®ç°æƒ…å†µ

- [x] è‡ªè¡Œå®šä¹‰å¸§ï¼ˆPDUï¼‰ç»“æ„ã€‚éœ€è¦åœ¨ PDU æœ«å°¾å¢åŠ  checksum å­—æ®µã€‚checksum é‡‡ç”¨
CRC-CCITT æ ‡å‡†ã€‚
  - è¿™é‡Œçš„PDUç»“æ„æ˜¯è‡ªå·±å®šä¹‰çš„ï¼Œç»„æˆéƒ¨åˆ†ä¸ºï¼š`frame_no,ack_no,data_size,data,checksum`ï¼Œå…¶ä¸­`frame_no`æ˜¯å¸§çš„åºå·ï¼Œ`ack_no`æ˜¯ç¡®è®¤å·ï¼Œ`data_size`æ˜¯æ•°æ®çš„å¤§å°ï¼Œ`data`æ˜¯æ•°æ®ï¼Œ`checksum`æ˜¯æ ¡éªŒå’Œã€‚
  - å…¶ä¸­è‡ªå·±å®ç°äº†å„ç§CRCæ ¡éªŒï¼ŒåŒ…æ‹¬CRC-CCITTï¼ŒCRC-16ï¼ŒCRC-32ç­‰å¹¶å°è£…æˆäº†ä¸€ä¸ªpackageï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨ã€‚
- [x] é‡‡ç”¨ UDP Socket API æ¨¡æ‹Ÿå¹¶å®ç° PDU çš„å‘é€å’Œæ¥æ”¶ï¼Œæ¯ä¸ª UDP æ•°æ®æŠ¥å°è£…ä¸€ä¸ª
PDUã€‚
- [x] PDU ä¸­æ•°æ®éƒ¨åˆ†çš„é•¿åº¦ä¸è¦è¶…è¿‡ 4KBã€‚è‡ªå·±çš„å®ç°ä¸­ï¼Œæ•°æ®éƒ¨åˆ†çš„é•¿åº¦ä¸º1KBã€‚
- [x] å®ç°çš„ GBN åè®®åº”æ”¯æŒå…¨åŒå·¥ï¼Œå®ç°åŒå‘æ–‡ä»¶ä¼ è¾“
- [x] ç”Ÿæˆå™¨æˆ–æ–¹æ³•ï¼Œå…è®¸æ ¹æ®é…ç½®æ–‡ä»¶ä¸­ç»™å‡ºçš„ç™¾åˆ†æ¯”ï¼ˆn%ï¼‰éšæœºäº§ç”Ÿ PDU é”™è¯¯å’Œ PDU ä¸¢å¤±
- [x] 3MB ä»¥ä¸Šçš„æ–‡ä»¶ç”¨äºæµ‹è¯•ã€‚æœ¬é¡¹ç›®ä¸­åˆ†åˆ«å‡†å¤‡äº†ä¸€ä¸ª 3MB ä»¥ä¸Šçš„`.png`å’Œ`.pdf`æ–‡ä»¶ï¼Œç”¨äºæµ‹è¯•ã€‚
- [x] æ–‡ä»¶ä¼ è¾“å®Œæ¯•åï¼Œæ¥æ”¶å¹¶ä¿å­˜çš„æ–‡ä»¶åº”ä¸å‘é€çš„åŸå§‹æ–‡ä»¶ä¸€æ¨¡ä¸€æ ·
- [x] é€šè¿‡é…ç½®æ–‡ä»¶é…ç½®é€šä¿¡é€šä¿¡æˆ–åè®®å‚æ•°
- [x] è®°å½•é€šä¿¡çŠ¶æ€åˆ°æ—¥å¿—ä¸­
- [ ] è¯»å–æ—¥å¿—æ–‡ä»¶ï¼Œå¯¹é€šä¿¡çŠ¶æ€è®°å½•æ•°æ®è¿›è¡Œç»Ÿè®¡åˆ†æï¼Œä»å¤šä¸ªç»´åº¦åˆ†ææ¯”è¾ƒä¸åŒçš„æ•°æ®å¤§å°ã€çª—å£å¤§å°ã€PDU é”™è¯¯ç‡ã€PDU ä¸¢å¤±ç‡å’Œè¶…æ—¶å€¼æ—¶çš„é€šä¿¡æ•ˆç‡ï¼Œä¾‹å¦‚ï¼šæ–‡ä»¶åˆ’åˆ†çš„ PDU æ€»æ•°é‡ï¼Œé€šä¿¡æ€»æ¬¡æ•°ï¼Œè¶…æ—¶æ¬¡æ•°ï¼Œé‡ä¼  PDU çš„æ•°é‡ã€æ€»è€—æ—¶ç­‰ï¼Œå¯ä»¥ç”¨å›¾è¡¨è¡¨ç¤ºï¼Œå¹¶å¾—å‡ºåˆ†æç»“è®º

## å¢å¼ºåŠŸèƒ½å®ç°æƒ…å†µ

- [x] æ”¯æŒå¤šå°ä¸»æœºä¹‹é—´çš„åŒæ—¶é€šä¿¡
- [x] é‡‡ç”¨å¤šçº¿ç¨‹å®ç°å¤šå°ä¸»æœºä¹‹é—´çš„åŒæ—¶é€šä¿¡

## æ—¥å¿—æ–‡ä»¶

å‘é€ç«¯å’Œæ¥æ”¶ç«¯éƒ½ä¼šè®°å½•æ—¥å¿—æ–‡ä»¶ï¼Œæ—¥å¿—æ–‡ä»¶çš„æ ¼å¼å¦‚ä¸‹ï¼š

### å‘é€æ–‡ä»¶ç«¯

- type: å¸§çš„ç±»å‹ï¼Œæœ‰Send, Recv
- pdu_to_send: å‘é€çš„å¸§çš„åºå·
- acked_no: å‘é€æ–‡ä»¶ç«¯å¸Œæœ›æ¥æ”¶æ–‡ä»¶ç«¯ç¡®è®¤çš„å¸§å· (è¯¥å¸§å·-1åˆ™æ˜¯å·²è¢«ç¡®è®¤çš„å¸§å·ï¼Œç´¯è®¡ç¡®è®¤)
- data_size: æ•°æ®çš„å¤§å°
- status: å½“å‰å¸§çš„çŠ¶æ€ï¼Œæœ‰New, Timeout, ReTransmit
  - New è¡¨ç¤ºæ–°å‘é€çš„å¸§
  - Timeout è¡¨ç¤ºè¶…æ—¶é‡ä¼ 
  - ReTransmit è¡¨ç¤ºé‡ä¼ 
- time: å‘é€å½“å‰å¸§çš„æ—¶é—´æˆ³

> å‘é€æ–‡ä»¶ç«¯

### æ¥æ”¶æ–‡ä»¶ç«¯

- type: å¸§çš„ç±»å‹ï¼Œæœ‰Send, Recv
- pdu_recv: å‘é€çš„å¸§çš„åºå·
- pdu_exp: æ¥å—æ–‡ä»¶ç«¯å¸Œæœ›å‘é€æ–‡ä»¶ç«¯å‘é€çš„å¸§å·
- data_size: æ•°æ®çš„å¤§å°
- status: å½“å‰å¸§çš„çŠ¶æ€ï¼Œæœ‰DataErr, NoErr, OK
  - DataErr è¡¨ç¤ºæ•°æ®å‡ºé”™
  - NoErr è¡¨ç¤ºæ•°æ®æ²¡æœ‰å‡ºé”™
  - OK è¡¨ç¤ºæ•°æ®æ­£ç¡®
- time: æ¥æ”¶å½“å‰å¸§çš„æ—¶é—´æˆ³

### å…·ä½“è®¾è®¡

| æ–‡æ¡£è¦æ±‚ | å®é™…ä»£ç  | å«ä¹‰ | å˜åŒ– |
| --- | --- | --- | --- |
| pdu_to_send | send_no | å‘é€ç«¯å‘é€çš„data frameçš„åºå· | æ¯å½“å‘é€ä¸€ä¸ªå¸§ï¼Œsend_no+1 |
| acked_no | recv_ack_no | å‘é€ç«¯å¸Œæœ›æ¥æ”¶ç«¯ç¡®è®¤çš„data frameçš„åºå· | æ¯å½“æ¥æ”¶åˆ°ä¸€ä¸ªACKï¼Œack_no+1 |
| pdu_recv | recv_no | æ¥æ”¶ç«¯å¸Œæœ›å‘é€ç«¯å‘é€çš„data frameçš„åºå· | æ¯å½“æ¥æ”¶åˆ°ä¸€ä¸ªå¸§ï¼Œrecv_no+1 |
| pdu_exp | send_ack_no | æ¥æ”¶ç«¯å‘é€çš„data frameçš„åºå· | æ¯å½“å‘é€ä¸€ä¸ªACKï¼Œsend_ack_no+1 |

ä¸‹é¢ç”¨ä»£ç æ¥è§£é‡Šä¸€ä¸‹ï¼š

```python
# å‘é€ç«¯
send_no = 1
recv_ack_no = 1
pdu = PDU(frame_no = send_no, ack_no = recv_ack_no, data)
send_pdu(pdu)
send_no += 1

# ğŸ‘‡

# æ¥æ”¶ç«¯
recv_no = 1
send_ack_no = 1
pdu = recv_pdu()
if recv_no == pdu.frame_no:
  recv_no += 1
  ack = PDU(frame_no = send_ack_no, ack_no = recv_no)
  send_ack(ack)
  send_ack_no += 1

# ğŸ‘‡

# å‘é€ç«¯
send_no = 2
recv_ack_no = 1
ack = recv_pdu()
if send_no == ack.ack_no:
  recv_ack_no += 1

# Finally
send_no = 2
recv_ack_no = 2
recv_no = 2
send_ack_no = 2
```